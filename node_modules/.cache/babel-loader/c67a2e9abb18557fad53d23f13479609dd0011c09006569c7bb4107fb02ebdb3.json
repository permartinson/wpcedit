{"ast":null,"code":"import \"core-js/modules/es.array.unshift.js\";\nimport \"core-js/modules/web.dom-exception.stack.js\";\nimport { defineStore } from 'pinia';\nimport { WPCEdit } from 'wpcedit';\nimport { useStorage } from '@vueuse/core';\nimport { set, get } from \"./idb.js\";\nimport { pad } from \"../helpers/formatting\";\nexport const useWpcEditStore = defineStore('wpcEditStore', {\n  state: () => {\n    return {\n      romIsLoaded: useStorage('romIsLoaded', false),\n      romIsAltered: useStorage('romIsAltered', false),\n      viewTitle: 'WPC Edit',\n      fileName: useStorage('fileName', ''),\n      isAtHomeView: true,\n      currSpriteIndex: 0,\n      currSpriteTableIndex: 0,\n      currentRomData: null,\n      spriteTableMap: null,\n      calculatedChecksum: '',\n      storedChecksum: '',\n      versionByte: '',\n      fixupBytes: '',\n      checksumIsValid: false,\n      exportOption: 0\n    };\n  },\n  getters: {\n    maxFullFrameIndex: state => {\n      /*\n      let index = 900;//WPCEdit.fullFrameImage.maxImageIndex;\n      let invalidImages = 0;\n      while(invalidImages<4 && index<2000) {\n          const plane = WPCEdit.fullFrameImage.getPlaneAt(index);\n          if(plane.type > 11 && plane.type != 255) {\n              invalidImages++;\n              console.log(\"INVALID at index: \"+index);\n          }\n          index++;\n      }\n      \n      //console.log(\"type: \"+plane.type);\n           console.log(\"max: \"+index)\n      return index;*/\n      console.log(state);\n      return 1000;\n    }\n  },\n  actions: {\n    getRomFromCache() {\n      const cachedFileName = this.fileName;\n      get('currentRomData').then(value => {\n        if (value != null) {\n          this.loadRom(value, cachedFileName);\n        }\n      });\n    },\n    loadRom(data, name) {\n      WPCEdit.init();\n      if (WPCEdit.setRom(data)) {\n        this.fileName = name;\n        this.romIsLoaded = true;\n        this.currentRomData = data;\n        set('currentRomData', this.currentRomData);\n        this.spriteTableMap = WPCEdit.variableSizedImage.indexMap;\n        this.storedChecksum = pad(WPCEdit.checksum.stored.toString(16), 4).toUpperCase();\n        this.calculatedChecksum = pad(WPCEdit.checksum.calculated.toString(16), 4).toUpperCase();\n        this.fixupBytes = pad(WPCEdit.checksum.delta.toString(16), 4).toUpperCase();\n        this.versionByte = pad((WPCEdit.checksum.stored & 0xFF).toString(16), 2).toString(16);\n        this.checksumIsValid = WPCEdit.checksum.isValid;\n        //WPCEdit.verbose = true;\n      }\n    },\n\n    unloadRom() {\n      set('currentRomData', null);\n      this.currentRomData = null;\n      this.romIsLoaded = false;\n      this.romIsAltered = false;\n      this.spriteTableMap = null;\n      this.currSpriteIndex = 0;\n      this.currSpriteTableIndex = 0;\n      this.currentRomData = null;\n      this.spriteTableMap = null;\n      this.calculatedChecksum = 0;\n      this.storedChecksum = 0;\n      this.versionByte = 0;\n      this.fixupBytes = 0;\n      this.checksumIsValid = false;\n    },\n    getFullFrameImageAt(index) {\n      return WPCEdit.fullFrameImage.getPlaneAt(index);\n    },\n    getSpriteAt(table, index) {\n      WPCEdit.variableSizedImage.table = table;\n      WPCEdit.variableSizedImage.index = index;\n      return WPCEdit.variableSizedImage.plane;\n    },\n    getSpriteCentered(table, index) {\n      WPCEdit.variableSizedImage.table = table;\n      WPCEdit.variableSizedImage.index = index;\n      const spritePlane = WPCEdit.variableSizedImage.plane;\n      const xOffset = Math.floor((128 - spritePlane.width) / 2);\n      const yOffset = Math.floor((32 - spritePlane.height) / 2);\n      const sprite = WPCEdit.variableSizedImage.placeInFullFrame(WPCEdit.variableSizedImage.plane, xOffset, yOffset);\n      return sprite;\n    },\n    getSpriteAsFullFrame(sprite, posX, posY) {\n      return sprite = WPCEdit.variableSizedImage.placeInFullFrame(sprite, posX, posY);\n    },\n    mergeImages(img1, img2, mask) {\n      return WPCEdit.fullFrameImage.mergeImages(img1, img2, mask);\n    },\n    updateChecksum(version) {\n      console.log(\"version is \" + version);\n      const result = WPCEdit.checksum.update(version);\n      if (result.status == 1) {\n        this.loadRom(result.data, this.fileName);\n        this.romIsAltered = true;\n      }\n      return result.status;\n    },\n    disableChecksum() {\n      const newRom = WPCEdit.checksum.disable();\n      this.loadRom(newRom, this.fileName);\n      this.romIsAltered = true;\n      const result = 1; //Temp! Use a status variable\n      return result;\n    },\n    setExportOption(option) {\n      this.exportOption = option;\n    },\n    exportAsDataArray(plane) {\n      let dataString = '{ ';\n      dataString += Array.from(plane).join(', ');\n      dataString += ' }';\n      return dataString;\n    },\n    exportAs1bitBmp(plane) {\n      const width = 128;\n      const height = 32;\n      // Mirror the bits because the BMP the data is encoded in reverse to the DMD data\n      for (let i = 0; i < plane.length; i++) {\n        plane[i] = mirrorBits(plane[i]);\n      }\n\n      // And flip rows because they are in reverse as well\n      const mirrored = new Uint8Array(plane.length);\n      const widthInBytes = Math.ceil(width / 8);\n      for (let i = 0; i < height; i++) {\n        const offset = i * widthInBytes;\n        const destOffset = mirrored.length - widthInBytes - offset;\n        const rowData = plane.slice(offset, offset + widthInBytes);\n        mirrored.set(rowData, destOffset);\n      }\n      const image = drawArray(Array.from(mirrored), 1, width, height);\n      return image;\n      function mirrorBits(n) {\n        // Borrowed from https://www.w3resource.com/javascript-exercises/javascript-basic-exercise-127.php\n        let t = n.toString(2).split(\"\");\n        let str_len = t.length;\n        for (let i = 0; i < 8 - str_len; i++) {\n          t.unshift(\"0\");\n        }\n        return parseInt(t.reverse().join(\"\"), 2);\n      }\n      function drawArray(arr, depth, width, height) {\n        // Borrowed from https://gist.github.com/vukicevic/8112515\n        let offset, data;\n        function conv(size) {\n          return String.fromCharCode(size & 0xff, size >> 8 & 0xff, size >> 16 & 0xff, size >> 24 & 0xff);\n        }\n        offset = depth <= 8 ? 54 + Math.pow(2, depth) * 4 : 54;\n\n        //BMP Header\n        data = 'BM'; // ID field\n        data += conv(offset + arr.length); // BMP size\n        data += conv(0); // unused\n        data += conv(offset); // pixel data offset\n\n        //DIB Header\n        data += conv(40); // DIB header length\n        data += conv(width); // image height\n        data += conv(height); // image width\n        data += String.fromCharCode(1, 0); // colour panes\n        data += String.fromCharCode(depth, 0); // bits per pixel\n        data += conv(0); // compression method\n        data += conv(arr.length); // size of the raw data\n        data += conv(2835); // horizontal print resolution\n        data += conv(2835); // vertical print resolution\n        data += conv(0); // colour palette, 0 == 2^n\n        data += conv(0); // important colours\n\n        //Grayscale tables for bit depths <= 8\n        if (depth <= 8) {\n          data += conv(0);\n          for (let s = Math.floor(255 / (Math.pow(2, depth) - 1)), i = s; i < 256; i += s) {\n            data += conv(i + i * 256 + i * 65536);\n          }\n        }\n\n        //Pixel data\n        data += String.fromCharCode.apply(String, arr);\n        return window.btoa(data);\n      }\n    },\n    downloadRom() {\n      const blob = new Blob([this.currentRomData], {\n        type: 'application/octet-stream'\n      });\n      const url = window.URL.createObjectURL(blob);\n      const nameWithoutExtension = this.fileName.replace(/\\.[^/.]+$/, \"\");\n      const extension = \"rom\";\n      const date = new Date();\n      const suffix = \"_\" + date.getFullYear() + \"\" + pad(date.getMonth() + 1, 2) + \"\" + pad(date.getDate(), 2) + \"\" + pad(date.getHours(), 2) + \"\" + pad(date.getMinutes(), 2) + \"_cs\" + this.storedChecksum;\n      const fileName = nameWithoutExtension + suffix + \".\" + extension;\n      downloadURL(url, fileName);\n      setTimeout(function () {\n        return window.URL.revokeObjectURL(url);\n      }, 1000);\n      // Hacky, but standard, way to download blobs:\n      // Turn it into a hidden href, then click the href and remove it\n      function downloadURL(data, fileName) {\n        const a = document.createElement('a');\n        a.href = data;\n        a.download = fileName;\n        document.body.appendChild(a);\n        a.style = 'display: none';\n        a.click();\n        a.remove();\n      }\n    }\n  },\n  persist: {\n    storage: localStorage\n  }\n});","map":{"version":3,"names":["defineStore","WPCEdit","useStorage","set","get","pad","useWpcEditStore","state","romIsLoaded","romIsAltered","viewTitle","fileName","isAtHomeView","currSpriteIndex","currSpriteTableIndex","currentRomData","spriteTableMap","calculatedChecksum","storedChecksum","versionByte","fixupBytes","checksumIsValid","exportOption","getters","maxFullFrameIndex","console","log","actions","getRomFromCache","cachedFileName","then","value","loadRom","data","name","init","setRom","variableSizedImage","indexMap","checksum","stored","toString","toUpperCase","calculated","delta","isValid","unloadRom","getFullFrameImageAt","index","fullFrameImage","getPlaneAt","getSpriteAt","table","plane","getSpriteCentered","spritePlane","xOffset","Math","floor","width","yOffset","height","sprite","placeInFullFrame","getSpriteAsFullFrame","posX","posY","mergeImages","img1","img2","mask","updateChecksum","version","result","update","status","disableChecksum","newRom","disable","setExportOption","option","exportAsDataArray","dataString","Array","from","join","exportAs1bitBmp","i","length","mirrorBits","mirrored","Uint8Array","widthInBytes","ceil","offset","destOffset","rowData","slice","image","drawArray","n","t","split","str_len","unshift","parseInt","reverse","arr","depth","conv","size","String","fromCharCode","pow","s","apply","window","btoa","downloadRom","blob","Blob","type","url","URL","createObjectURL","nameWithoutExtension","replace","extension","date","Date","suffix","getFullYear","getMonth","getDate","getHours","getMinutes","downloadURL","setTimeout","revokeObjectURL","a","document","createElement","href","download","body","appendChild","style","click","remove","persist","storage","localStorage"],"sources":["/Users/permartinson/Documents/GitHub/wpcedit-vue/src/stores/wpcEditStore.js"],"sourcesContent":["import { defineStore } from 'pinia';\nimport { WPCEdit } from 'wpcedit';\nimport { useStorage } from '@vueuse/core';\nimport { set, get } from \"./idb.js\";\nimport { pad } from \"../helpers/formatting\";\n\nexport const useWpcEditStore = defineStore('wpcEditStore', {\n    state: () => {\n        return {\n            romIsLoaded: useStorage('romIsLoaded',false),\n            romIsAltered: useStorage('romIsAltered',false),\n            viewTitle: 'WPC Edit',\n            fileName: useStorage('fileName',''),\n            isAtHomeView: true,\n            currSpriteIndex: 0,\n            currSpriteTableIndex: 0,\n            currentRomData: null,\n            spriteTableMap: null,\n            calculatedChecksum: '',\n            storedChecksum: '',\n            versionByte: '',\n            fixupBytes: '',\n            checksumIsValid: false,\n            exportOption: 0\n        }\n    },\n    getters: {\n        maxFullFrameIndex: (state) => {\n            /*\n            let index = 900;//WPCEdit.fullFrameImage.maxImageIndex;\n            let invalidImages = 0;\n            while(invalidImages<4 && index<2000) {\n                const plane = WPCEdit.fullFrameImage.getPlaneAt(index);\n                if(plane.type > 11 && plane.type != 255) {\n                    invalidImages++;\n                    console.log(\"INVALID at index: \"+index);\n                }\n                index++;\n            }\n            \n            //console.log(\"type: \"+plane.type);\n    \n            console.log(\"max: \"+index)\n            return index;*/\n            console.log(state);\n            return 1000;\n        }\n    },\n    actions: {\n        getRomFromCache() {\n            const cachedFileName = this.fileName;\n            get('currentRomData').then(\n                (value) => {\n                    if (value != null) {\n                        this.loadRom(value,cachedFileName);\n                    }\n                }\n            );\n        },\n        loadRom(data,name) {\n            WPCEdit.init();\n            if(WPCEdit.setRom(data)) {\n                this.fileName = name;\n                this.romIsLoaded = true;\n                this.currentRomData = data;\n                set('currentRomData',this.currentRomData);\n                this.spriteTableMap = WPCEdit.variableSizedImage.indexMap;\n                this.storedChecksum = pad(WPCEdit.checksum.stored.toString(16),4).toUpperCase();\n                this.calculatedChecksum = pad(WPCEdit.checksum.calculated.toString(16),4).toUpperCase();\n                this.fixupBytes = pad(WPCEdit.checksum.delta.toString(16),4).toUpperCase();\n                this.versionByte = pad((WPCEdit.checksum.stored & 0xFF).toString(16),2).toString(16);\n                this.checksumIsValid = WPCEdit.checksum.isValid;\n                //WPCEdit.verbose = true;\n            }            \n        },\n        unloadRom() {\n            set('currentRomData',null);\n            this.currentRomData = null;\n            this.romIsLoaded = false;\n            this.romIsAltered = false;\n            this.spriteTableMap = null;\n            this.currSpriteIndex = 0;\n            this.currSpriteTableIndex = 0;\n            this.currentRomData = null;\n            this.spriteTableMap = null;\n            this.calculatedChecksum = 0;\n            this.storedChecksum = 0;\n            this.versionByte = 0;\n            this.fixupBytes = 0;\n            this.checksumIsValid = false;\n        },\n        getFullFrameImageAt(index) {\n            return WPCEdit.fullFrameImage.getPlaneAt(index);\n        },\n        getSpriteAt(table,index) {\n            WPCEdit.variableSizedImage.table = table;\n            WPCEdit.variableSizedImage.index = index;\n            return WPCEdit.variableSizedImage.plane;\n        },\n        getSpriteCentered(table,index) {\n            WPCEdit.variableSizedImage.table = table;\n            WPCEdit.variableSizedImage.index = index;\n            const spritePlane = WPCEdit.variableSizedImage.plane\n            const xOffset = Math.floor((128-spritePlane.width)/2);\n            const yOffset = Math.floor((32-spritePlane.height)/2);\n            const sprite = WPCEdit.variableSizedImage.placeInFullFrame(WPCEdit.variableSizedImage.plane,xOffset,yOffset)\n            return sprite;\n        },\n        getSpriteAsFullFrame(sprite,posX,posY) {\n            return sprite = WPCEdit.variableSizedImage.placeInFullFrame(sprite,posX,posY)\n        },\n        mergeImages(img1,img2,mask) {\n            return WPCEdit.fullFrameImage.mergeImages(img1,img2,mask);\n        },\n        updateChecksum(version) {\n            console.log(\"version is \"+ version)\n            const result = WPCEdit.checksum.update(version);\n            if(result.status == 1) {\n                this.loadRom(result.data,this.fileName);\n                this.romIsAltered = true;\n            }\n            return result.status;\n        },\n        disableChecksum() {\n            const newRom = WPCEdit.checksum.disable();\n            this.loadRom(newRom,this.fileName);\n            this.romIsAltered = true;\n            const result = 1; //Temp! Use a status variable\n            return result;\n        },\n        setExportOption(option) {\n            this.exportOption = option;\n        },\n        exportAsDataArray(plane) {\n            let dataString = '{ ';\n            dataString += (Array.from(plane)).join(', ');\n            dataString += ' }';\n            return dataString;\n        },\n        exportAs1bitBmp(plane) {\n            const width = 128;\n            const height = 32;\n            // Mirror the bits because the BMP the data is encoded in reverse to the DMD data\n            for(let i=0; i<plane.length; i++) {\n                plane[i] = mirrorBits(plane[i]);\n            }\n\n            // And flip rows because they are in reverse as well\n            const mirrored = new Uint8Array(plane.length);\n            const widthInBytes = Math.ceil(width/8);\n            for(let i=0; i<height; i++) {\n                const offset = i * widthInBytes;\n                const destOffset = mirrored.length - widthInBytes - offset;\n                const rowData = plane.slice(offset,offset+widthInBytes);\n                mirrored.set(rowData,destOffset);\n            }\n\n            const image = drawArray(Array.from(mirrored),1,width,height);\n            return image;\n\n            function mirrorBits(n) {\n                // Borrowed from https://www.w3resource.com/javascript-exercises/javascript-basic-exercise-127.php\n                let t = n.toString(2).split(\"\");\n                let str_len = t.length;\n                for (let i = 0; i < 8 - str_len; i++) {\n                    t.unshift(\"0\");\n                }\n                return parseInt(t.reverse().join(\"\"), 2);\n            }\n\n            function drawArray(arr, depth, width, height) {\n                // Borrowed from https://gist.github.com/vukicevic/8112515\n                let offset, data;\n            \n                function conv(size) {\n                    return String.fromCharCode(size&0xff, (size>>8)&0xff, (size>>16)&0xff, (size>>24)&0xff);\n                }\n            \n                offset = depth <= 8 ? 54 + Math.pow(2, depth)*4 : 54;\n            \n                //BMP Header\n                data  = 'BM';                          // ID field\n                data += conv(offset + arr.length);     // BMP size\n                data += conv(0);                       // unused\n                data += conv(offset);                  // pixel data offset\n                \n                //DIB Header\n                data += conv(40);                       // DIB header length\n                data += conv(width);                    // image height\n                data += conv(height);                   // image width\n                data += String.fromCharCode(1, 0);      // colour panes\n                data += String.fromCharCode(depth, 0);  // bits per pixel\n                data += conv(0);                        // compression method\n                data += conv(arr.length);               // size of the raw data\n                data += conv(2835);                     // horizontal print resolution\n                data += conv(2835);                     // vertical print resolution\n                data += conv(0);                        // colour palette, 0 == 2^n\n                data += conv(0);                        // important colours\n                \n                //Grayscale tables for bit depths <= 8\n                if (depth <= 8) {\n                    data += conv(0);\n                    \n                    for (let s = Math.floor(255/(Math.pow(2, depth)-1)), i = s; i < 256; i += s)  {\n                        data += conv(i + i*256 + i*65536);\n                    }\n                }\n                \n                //Pixel data\n                data += String.fromCharCode.apply(String, arr);\n\n                return window.btoa(data);\n            }\n  \n        },\n        downloadRom() {\n            const blob = new Blob([this.currentRomData], {\n              type: 'application/octet-stream'\n            });\n            const url = window.URL.createObjectURL(blob);\n\n            const nameWithoutExtension = this.fileName.replace(/\\.[^/.]+$/, \"\");\n            const extension = \"rom\";\n            const date = new Date();\n            const suffix = \"_\"+date.getFullYear()+\"\"+pad(date.getMonth()+1,2)+\"\"+pad(date.getDate(),2)+\"\"+pad(date.getHours(),2)+\"\"+pad(date.getMinutes(),2)+\"_cs\"+this.storedChecksum;\n            const fileName = nameWithoutExtension + suffix + \".\" + extension;\n\n            downloadURL(url, fileName);\n            setTimeout(function() {\n              return window.URL.revokeObjectURL(url);\n            }, 1000);\n            // Hacky, but standard, way to download blobs:\n            // Turn it into a hidden href, then click the href and remove it\n            function downloadURL(data, fileName) {\n                const a = document.createElement('a');\n                a.href = data;\n                a.download = fileName;\n                document.body.appendChild(a);\n                a.style = 'display: none';\n                a.click();\n                a.remove();\n            }\n        }\n    },\n    persist: {\n        storage: localStorage\n    },\n})"],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}