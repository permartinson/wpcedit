{"ast":null,"code":"import { resolveComponent as _resolveComponent, createVNode as _createVNode, createElementVNode as _createElementVNode, withCtx as _withCtx, openBlock as _openBlock, createBlock as _createBlock, pushScopeId as _pushScopeId, popScopeId as _popScopeId } from \"vue\";\nconst _withScopeId = n => (_pushScopeId(\"data-v-7eff97cc\"), n = n(), _popScopeId(), n);\nconst _hoisted_1 = {\n  class: \"modal-body\"\n};\nconst _hoisted_2 = {\n  class: \"sub-dmds\"\n};\nexport function render(_ctx, _cache, $props, $setup, $data, $options) {\n  const _component_ModalHeader = _resolveComponent(\"ModalHeader\");\n  const _component_MainDmd = _resolveComponent(\"MainDmd\");\n  const _component_SubDmd = _resolveComponent(\"SubDmd\");\n  const _component_OffsetControl = _resolveComponent(\"OffsetControl\");\n  const _component_ExportSection = _resolveComponent(\"ExportSection\");\n  const _component_ModalFooter = _resolveComponent(\"ModalFooter\");\n  const _component_BaseModal = _resolveComponent(\"BaseModal\");\n  return _openBlock(), _createBlock(_component_BaseModal, {\n    show: $props.show,\n    onClose: _cache[9] || (_cache[9] = $event => _ctx.$emit('close'))\n  }, {\n    default: _withCtx(() => [_createVNode(_component_ModalHeader, {\n      stepBtns: true,\n      closeBtn: true,\n      title: $options.title,\n      onNext: _cache[0] || (_cache[0] = $event => $options.goNext()),\n      onPrev: _cache[1] || (_cache[1] = $event => $options.goPrev()),\n      onNext2: _cache[2] || (_cache[2] = $event => $options.goN2()),\n      onPrev2: _cache[3] || (_cache[3] = $event => $options.goP2()),\n      onClose: _cache[4] || (_cache[4] = $event => _ctx.$emit('close'))\n    }, null, 8 /* PROPS */, [\"title\"]), _createElementVNode(\"div\", _hoisted_1, [_createVNode(_component_MainDmd, {\n      image0: $options.image0(),\n      image1: $options.image1(),\n      index: $options.planeIndices.current,\n      ref: \"main\"\n    }, null, 8 /* PROPS */, [\"image0\", \"image1\", \"index\"]), _createElementVNode(\"div\", _hoisted_2, [_createElementVNode(\"div\", null, [_createVNode(_component_SubDmd, {\n      class: \"plane plane0\",\n      title: this.currPlaneTitle,\n      isEnabled: true,\n      image: $options.image0()\n    }, null, 8 /* PROPS */, [\"title\", \"image\"]), _createVNode(_component_OffsetControl, {\n      onMoveX: $options.moveSprite0X,\n      onMoveY: $options.moveSprite0Y,\n      xOffset: $data.xOffset0,\n      yOffset: $data.yOffset0\n    }, null, 8 /* PROPS */, [\"onMoveX\", \"onMoveY\", \"xOffset\", \"yOffset\"])]), _createElementVNode(\"div\", null, [_createVNode(_component_SubDmd, {\n      class: \"plane plane1\",\n      checkbox: this.blendPlaneLabel,\n      image: $options.blendImage(),\n      isEnabled: this.doBlend,\n      navBtns: true,\n      onNext: _cache[5] || (_cache[5] = $event => $options.goToNextBlendPlane()),\n      onPrev: _cache[6] || (_cache[6] = $event => $options.goToPrevBlendPlane()),\n      onEnabled: $options.setBlendStatus\n    }, null, 8 /* PROPS */, [\"checkbox\", \"image\", \"isEnabled\", \"onEnabled\"]), _createVNode(_component_OffsetControl, {\n      onMoveX: $options.moveSprite1X,\n      onMoveY: $options.moveSprite1Y,\n      xOffset: $data.xOffset1,\n      yOffset: $data.yOffset1\n    }, null, 8 /* PROPS */, [\"onMoveX\", \"onMoveY\", \"xOffset\", \"yOffset\"])])])]), _createVNode(_component_ModalFooter, null, {\n      default: _withCtx(() => [_createVNode(_component_ExportSection, {\n        onExportMain: _cache[7] || (_cache[7] = $event => $options.exportCurrentSprite(0)),\n        onExportBlend: _cache[8] || (_cache[8] = $event => $options.exportCurrentSprite(1)),\n        options: $data.options\n      }, null, 8 /* PROPS */, [\"options\"])]),\n      _: 1 /* STABLE */\n    })]),\n\n    _: 1 /* STABLE */\n  }, 8 /* PROPS */, [\"show\"]);\n}","map":{"version":3,"mappings":";;;EAYaA,KAAK,EAAC;AAAY;;EAEdA,KAAK,EAAC;AAAU;;;;;;;;;uBAb7BC,aAoDYC;IApDAC,IAAI,EAAEC,WAAI;IAAGC,OAAK,sCAAEC,UAAK;;sBACjC,MASc,CATdC,aAScC;MARTC,QAAQ,EAAE,IAAI;MACdC,QAAQ,EAAE,IAAI;MACdC,KAAK,EAAEC,cAAK;MACZC,MAAI,sCAAED,eAAM;MACZE,MAAI,sCAAEF,eAAM;MACZG,OAAK,sCAAEH,aAAI;MACXI,OAAK,sCAAEJ,aAAI;MACXP,OAAK,sCAAEC,UAAK;wCAEjBW,oBAoCM,OApCNC,UAoCM,GAnCFX,aAAkGY;MAAxFC,MAAM,EAAER,eAAM;MAAKS,MAAM,EAAET,eAAM;MAAKU,KAAK,EAAEV,qBAAY,CAACW,OAAO;MAAEC,GAAG,EAAC;4DACjFP,oBAiCM,OAjCNQ,UAiCM,GAhCFR,oBAaM,cAZFV,aAKSmB;MAJL1B,KAAK,EAAC,cAAc;MACnBW,KAAK,OAAOgB,cAAc;MAC1BC,SAAS,EAAE,IAAI;MACfC,KAAK,EAAEjB,eAAM;iDAElBL,aAKgBuB;MAJXC,OAAM,EAAEnB,qBAAY;MACpBoB,OAAM,EAAEpB,qBAAY;MACpBqB,OAAO,EAAEC,cAAQ;MACjBC,OAAO,EAAED;6EAGlBjB,oBAiBM,cAhBFV,aASSmB;MARL1B,KAAK,EAAC,cAAc;MACnBoC,QAAQ,OAAOC,eAAe;MAC9BR,KAAK,EAAEjB,mBAAU;MACjBgB,SAAS,OAAOU,OAAO;MACvBC,OAAO,EAAE,IAAI;MACb1B,MAAI,sCAAED,2BAAkB;MACxBE,MAAI,sCAAEF,2BAAkB;MACxB4B,SAAO,EAAE5B;8EAEdL,aAKgBuB;MAJXC,OAAM,EAAEnB,qBAAY;MACpBoB,OAAM,EAAEpB,qBAAY;MACpBqB,OAAO,EAAEC,cAAQ;MACjBC,OAAO,EAAED;iFAK1B3B,aAGckC;wBAFV,MACgB,CADhBlC,aACgBmC;QADAC,YAAW,sCAAE/B,4BAAmB;QAAMgC,aAAY,sCAAEhC,4BAAmB;QAAMiC,OAAO,EAAEX","names":["class","_createBlock","_component_BaseModal","show","$props","onClose","_ctx","_createVNode","_component_ModalHeader","stepBtns","closeBtn","title","$options","onNext","onPrev","onNext2","onPrev2","_createElementVNode","_hoisted_1","_component_MainDmd","image0","image1","index","current","ref","_hoisted_2","_component_SubDmd","currPlaneTitle","isEnabled","image","_component_OffsetControl","onMoveX","onMoveY","xOffset","$data","yOffset","checkbox","blendPlaneLabel","doBlend","navBtns","onEnabled","_component_ModalFooter","_component_ExportSection","onExportMain","onExportBlend","options"],"sourceRoot":"","sources":["/Users/permartinson/Documents/GitHub/wpcedit-vue/src/components/ui/modals/SpriteModal.vue"],"sourcesContent":["<template>\n    <BaseModal :show=\"show\" @close=\"$emit('close')\">\n        <ModalHeader\n            :stepBtns=\"true\"\n            :closeBtn=\"true\"\n            :title=\"title\"\n            @next=\"goNext()\"\n            @prev=\"goPrev()\"\n            @next2=\"goN2()\"\n            @prev2=\"goP2()\"\n            @close=\"$emit('close')\">\n        </ModalHeader>\n        <div class=\"modal-body\">\n            <MainDmd :image0=\"image0()\" :image1=\"image1()\" :index=\"planeIndices.current\" ref=\"main\"></MainDmd>\n            <div class=\"sub-dmds\">\n                <div>\n                    <SubDmd\n                        class=\"plane plane0\"\n                        :title=\"this.currPlaneTitle\"\n                        :isEnabled=\"true\"\n                        :image=\"image0()\">\n                    </SubDmd>\n                    <OffsetControl\n                        @move-x=\"moveSprite0X\"\n                        @move-y=\"moveSprite0Y\"\n                        :xOffset=\"xOffset0\"\n                        :yOffset=\"yOffset0\">\n                    </OffsetControl>\n                </div>\n                <div>\n                    <SubDmd\n                        class=\"plane plane1\"\n                        :checkbox=\"this.blendPlaneLabel\"\n                        :image=\"blendImage()\"\n                        :isEnabled=\"this.doBlend\"\n                        :navBtns=\"true\"\n                        @next=\"goToNextBlendPlane()\"\n                        @prev=\"goToPrevBlendPlane()\"\n                        @enabled=\"setBlendStatus\">\n                    </SubDmd>\n                    <OffsetControl\n                        @move-x=\"moveSprite1X\"\n                        @move-y=\"moveSprite1Y\"\n                        :xOffset=\"xOffset1\"\n                        :yOffset=\"yOffset1\">\n                    </OffsetControl>\n                </div>\n            </div>\n        </div>\n        <ModalFooter>\n            <ExportSection @export-main=\"exportCurrentSprite(0)\" @export-blend=\"exportCurrentSprite(1)\" :options=\"options\">\n            </ExportSection>\n        </ModalFooter>\n    </BaseModal>\n</template>\n\n<script>\nimport BaseModal from './BaseModal.vue';\nimport ModalHeader from './ModalHeader.vue';\nimport ModalFooter from './ModalFooter.vue';\nimport ExportSection from '../ExportSection.vue';\nimport MainDmd from '../../dmd/MainDmd.vue';\nimport SubDmd from '../../dmd/SubDmd.vue';\nimport OffsetControl from '../../ui/OffsetControl.vue';\nimport { toHex } from '../../../helpers/formatting.js';\nimport { storeToRefs } from 'pinia';\nimport store from \"../../../stores/store.js\";\nimport { useMainStore } from '../../../stores/mainStore.js';\n\nconst MainStore = useMainStore(store);\n\nexport default {\n    name: 'SpriteModal',\n    components: { \n        BaseModal,\n        ModalHeader,\n        ModalFooter,\n        ExportSection,\n        MainDmd,\n        SubDmd,\n        OffsetControl\n    },\n    setup() {\n        const { exportOption, settings } = storeToRefs(MainStore);\n        return {\n            exportOption,\n            settings\n        }\n    },\n    data() {\n        // fetch the selected export option and create an object to pass the data for the selector\n        const options = new Array();\n        const labels = [\n            'PNG image from render',\n            'Monochrome BMP image',\n            'Monochrome BMP image (inverted)',\n            'Raw byte array'\n        ]\n        for(let i=0;i<labels.length;i++) {\n            const selected = (i == this.exportOption);\n            options.push({value:i,label:labels[i],selected:selected})\n        }\n\n        return {\n            doBlend: false,\n            offset: 0,\n            blendOffset: 1,\n            xOffset0: -1,\n            yOffset0: -1,\n            xOffset1: -1,\n            yOffset1: -1,\n            options\n        }\n    },\n    props: {\n        show: Boolean,\n        index: Number,\n        table: Number\n    },\n    computed: {\n        planeIndices() {\n            const currIndex = Math.max(this.index+this.offset,0);\n            return {\n                current: currIndex,\n                blend: Math.max(currIndex+this.blendOffset,0),\n            }\n        },\n        currPlaneTitle() {\n            return `This sprite, index ${this.planeIndices.current}`;\n        },\n        blendPlaneLabel() {\n            return `Blend with index ${this.planeIndices.blend}`;\n        },\n        title() {\n            return `Image ${toHex(MainStore.getSpriteAt(this.table,this.planeIndices.current).address,6)}`;\n        }\n    },\n    methods: {\n        image0() {\n            const indices = this.planeIndices;\n            const sprite = MainStore.getSpriteAt(this.table,indices.current);\n            // when the offset values of the main frame are init (-1), compute a center position and use as offset value:\n            if(this.xOffset0 == -1 && this.yOffset0 == -1) {\n                this.xOffset0 = Math.floor((128-sprite.width)/2);\n                this.yOffset0 = Math.floor((32-sprite.height)/2);\n            }\n            // position the sprite in a full frame at the offset position\n            return MainStore.getSpriteAsFullFrame(sprite,this.xOffset0,this.yOffset0);\n        },\n        image1() {\n            if(this.doBlend) {\n                return this.blendImage();\n            }\n            return this.image0();\n        },\n        blendImage() {\n            const indices = this.planeIndices;\n            const sprite = MainStore.getSpriteAt(this.table,indices.blend);\n            // when the offset values of the blend frame are init (-1), compute a center position and use as offset value:\n            if(this.xOffset1 == -1 && this.yOffset1 == -1) {\n                this.xOffset1 = Math.floor((128-sprite.width)/2);\n                this.yOffset1 = Math.floor((32-sprite.height)/2);\n            }\n            // position the sprite in a full frame at the offset position\n            return MainStore.getSpriteAsFullFrame(sprite,this.xOffset1,this.yOffset1);\n        },\n        setBlendStatus(state) {\n            if(state == true) {\n                this.doBlend = true;\n            } else if(state == false) {\n                this.doBlend = false;\n            }\n        },\n        goToNextBlendPlane() {\n            this.blendOffset++;\n        },\n        goToPrevBlendPlane() {\n            this.blendOffset--;\n        },\n        goNext() {\n            this.offset++;\n            this.setInitValues();\n        },\n        goPrev() {\n            if(this.planeIndices.current > 0) {\n                this.offset--;\n            }\n            this.setInitValues();\n        },\n        goN2() {\n            this.offset+=2;\n            this.setInitValues();\n        },\n        goP2() {\n            if(this.planeIndices.current > 0) {\n                this.offset-=2;\n            }\n            this.setInitValues();\n        },\n        moveSprite0X(amount) {\n            this.xOffset0 += amount;\n        },\n        moveSprite0Y(amount) {\n            this.yOffset0 += amount;\n        },\n        moveSprite1X(amount) {\n            this.xOffset1 += amount;\n        },\n        moveSprite1Y(amount) {\n            this.yOffset1 += amount;\n        },\n        setInitValues() {\n            // reset the values\n            this.blendOffset = 1;\n            //this.xOffset0 = -1;\n            //this.yOffset0 = -1;\n            //this.xOffset1 = -1;\n            //this.yOffset1 = -1;\n        },\n        exportCurrentSprite(planeToExport) {\n            let index = this.planeIndices.current;\n            if(planeToExport == 1) {\n                index = this.planeIndices.blend;\n            }\n            if(this.exportOption == 0) { // png export is handled within the main dmd component:\n                this.$refs.main.downloadPng();\n            } else if(this.exportOption == 3) { // raw data array export\n                const dataString =  MainStore.exportAsDataArray(MainStore.getSpriteAt(this.table,index).image);\n                let link = document.createElement(\"a\");\n                link.href = 'data:text/plain;charset=utf-8,' + encodeURIComponent(dataString);\n                const filename = \"plane\"+index+\".txt\";\n                link.download = filename;\n                link.style.display = \"none\";\n                document.body.appendChild(link);\n                link.click();\n                link.parentNode.removeChild(link);\n            } else if(this.exportOption == 1 || this.exportOption == 2) { // bitmap export\n                let inverted = false;\n                if(this.exportOption == 2) {\n                    inverted = true;\n                }\n                const sprite = MainStore.getSpriteAt(this.table,index);\n                const image = MainStore.getSpriteAsFullFrame(sprite,this.xOffset1,this.yOffset1);\n                let bmp = MainStore.exportAs1bitBmp(image,inverted,128,32);\n                let link = document.createElement(\"a\");\n                link.href = 'data:image/bmp;base64,' + bmp;\n                const filename = \"plane\"+index+\".bmp\";\n                link.download = filename;\n                link.style.display = \"none\";\n                document.body.appendChild(link);\n                link.click();\n                link.parentNode.removeChild(link);\n            }\n        }\n    },\n    updated() {\n        this.offset = 0;\n        this.setInitValues();\n    }\n}\n</script>\n\n<style scoped>\n.sub-dmds {\n    margin-top: var(--space-md);\n    display: grid;\n    gap: var(--space-md);\n    grid-template-columns: 1fr 1fr;\n}\n.plane {\n    justify-self: left;\n}\n.modal-body {\n    margin: 0 var(--space-md);\n}\n</style>"]},"metadata":{},"sourceType":"module","externalDependencies":[]}